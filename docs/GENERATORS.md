# Generators Guide

Generators transform the generic ai-tool-sync format into tool-specific outputs. Each generator understands the requirements and conventions of its target tool.

## Table of Contents

- [Overview](#overview)
- [Target Comparison](#target-comparison)
- [Cursor Generator](#cursor-generator)
- [Claude Generator](#claude-generator)
- [Factory Generator](#factory-generator)
- [Subfolder Context Generator](#subfolder-context-generator)
- [Tool Mapping](#tool-mapping)
- [Model Mapping](#model-mapping)
- [Customizing Output](#customizing-output)

## Overview

After loaders collect content, generators transform it for each configured target:

```
┌─────────────────────────────────────────────────────────────┐
│                    Generic Format                            │
│  (rules, personas, commands, hooks)                         │
└─────────────────────────────────────────────────────────────┘
                           │
          ┌────────────────┼────────────────┐
          │                │                │
          ▼                ▼                ▼
    ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  Cursor  │     │  Claude  │     │ Factory  │
    └──────────┘     └──────────┘     └──────────┘
          │                │                │
          ▼                ▼                ▼
  .cursor/rules/    .claude/skills/   .factory/skills/
  AGENTS.md         CLAUDE.md         AGENTS.md
```

Configure targets in `.ai/config.yaml`:

```yaml
targets:
  - cursor
  - claude
  - factory
```

## Target Comparison

| Feature | Cursor | Claude Code | Factory |
|---------|--------|-------------|---------|
| Rules format | `.mdc` files | Skill directories | Skill directories |
| Rules location | `.cursor/rules/` | `.claude/skills/*/SKILL.md` | `.factory/skills/*/SKILL.md` |
| Personas format | Command roles | Agent files | Droid files |
| Personas location | `.cursor/commands/roles/` | `.claude/agents/` | `.factory/droids/` |
| Commands | `.cursor/commands/` | settings.json | `.factory/commands/` |
| Hooks | ❌ Not supported | ✅ settings.json | ❌ Not supported |
| Entry point | `AGENTS.md` | `CLAUDE.md` | `AGENTS.md` |
| Import syntax | ❌ | `@import` | ❌ |

## Cursor Generator

Generates configuration for [Cursor IDE](https://cursor.com).

### Output Structure

```
.cursor/
├── rules/
│   ├── _core.mdc
│   ├── database.mdc
│   └── security.mdc
└── commands/
    └── roles/
        ├── architect.md
        └── implementer.md
AGENTS.md
```

### Rule Transformation

**Generic format:**

```yaml
---
name: database
description: Database guidelines
always_apply: false
globs:
  - "**/*.sql"
  - "**/migrations/**"
---
```

**Cursor output (`.mdc`):**

```yaml
---
description: Database guidelines
alwaysApply: false
globs: "**/*.sql,**/migrations/**"
---
```

**Key transformations:**
- `always_apply` → `alwaysApply` (camelCase)
- `globs` array → comma-separated string
- `name` removed (filename is the identifier)

### Persona Transformation

Personas become command roles in Cursor:

**Location:** `.cursor/commands/roles/<name>.md`

**Format:**

```markdown
---
name: architect
description: Strategic systems architect
---

# The Architect

[Persona content...]
```

### Entry Point

`AGENTS.md` at project root lists all available personas:

```markdown
<!-- DO NOT EDIT - Generated by ai-tool-sync -->

# Available Roles

Use these personas to guide AI behavior:

## architect
Strategic systems architect for design reviews

## implementer
Pragmatic coding craftsman for implementation
```

### Unsupported Features

Cursor does not support hooks. When hooks are configured, a warning is logged during sync.

---

## Claude Generator

Generates configuration for [Claude Code](https://claude.ai/code).

### Output Structure

```
.claude/
├── skills/
│   ├── _core/
│   │   └── SKILL.md
│   ├── database/
│   │   └── SKILL.md
│   └── security/
│       └── SKILL.md
├── agents/
│   ├── architect.md
│   └── implementer.md
├── commands/
│   └── deploy.md
└── settings.json
CLAUDE.md
```

### Rule Transformation (Skills)

Rules become skills in Claude's subdirectory format:

**Generic format:**

```yaml
---
name: database
description: Database guidelines
version: 1.0.0
always_apply: false
globs:
  - "**/*.sql"
priority: high
---

# Database Guidelines
...
```

**Claude output (`.claude/skills/database/SKILL.md`):**

```yaml
---
name: database
description: Database guidelines
always_apply: false
globs:
  - "**/*.sql"
priority: high
---

# Database Guidelines
...
```

### Persona Transformation (Agents)

Personas become agents:

**Location:** `.claude/agents/<name>.md`

**Format:**

```yaml
---
name: architect
description: Strategic systems architect
tools: Read, Write, Edit, Bash, Search, Glob
model: claude-sonnet-4-20250514
---

# The Architect

[Persona content...]
```

**Tool mapping:**
- `read` → `Read`
- `write` → `Write`
- `edit` → `Edit`
- `execute` → `Bash`
- `search` → `Search`
- `glob` → `Glob`

> Claude-specific overrides: `claude.tools` and `claude.model` in persona frontmatter override the generic `tools`/`model` values when generating Claude agents. Other targets continue to use the generic fields.

### Command Files

Commands are emitted to `.claude/commands/<name>.md` and become available as `/name` slash commands when present:

```markdown
# /deploy
> Deploy application to the selected environment

## Usage

Use `$ARGUMENTS` to pass user input into the command execution.

Arguments:
- **environment** (string) (required) [default: staging]
  Target environment for deployment. Choices: staging, production

## Execute

`npm run deploy $ARGUMENTS`

# Deploy Command

Runs the deployment script with the provided environment.
```

> Claude does not use tool mapping for commands; `$ARGUMENTS` is substituted directly into the `execute` string.

### Hooks Configuration

Hooks are written to `settings.json`:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "name": "safety-check",
        "match": "Bash(*rm*)",
        "action": "warn",
        "message": "Destructive command detected"
      }
    ]
  }
}
```

### Entry Point with @import

`CLAUDE.md` uses `@import` syntax for always-apply rules:

```markdown
<!-- DO NOT EDIT - Generated by ai-tool-sync -->

# Project Context

@import .claude/skills/_core/SKILL.md

## Available Skills

- database - Database guidelines
- security - Security best practices

## Available Agents

- architect - Strategic systems architect
- implementer - Pragmatic coding craftsman
```

---

## Factory Generator

Generates configuration for Factory.

### Output Structure

```
.factory/
├── skills/
│   ├── _core/
│   │   └── SKILL.md
│   ├── database/
│   │   └── SKILL.md
│   └── security/
│       └── SKILL.md
├── droids/
│   ├── architect.md
│   └── implementer.md
└── commands/
    └── deploy.md
AGENTS.md
```

### Rule Transformation (Skills)

Similar to Claude, rules become skills:

**Location:** `.factory/skills/<name>/SKILL.md`

### Persona Transformation (Droids)

Personas become droids:

**Location:** `.factory/droids/<name>.md`

**Format:**

```yaml
---
name: architect
description: Strategic systems architect
tools: read, write, edit, execute, search, glob
model: default
---

# The Architect

[Persona content...]
```

**Note:** Factory uses lowercase tool names.

### Command Generation

Commands are written to `.factory/commands/`:

```yaml
---
name: deploy
description: Deploy to production
execute: scripts/deploy.sh
args:
  - name: environment
    type: string
    default: staging
---

# Deploy Command

[Command documentation...]
```

### Entry Point

`AGENTS.md` lists skills and droids:

```markdown
<!-- DO NOT EDIT - Generated by ai-tool-sync -->

# Factory Configuration

## Available Skills

- _core - Core project context
- database - Database guidelines

## Available Droids

- architect - Strategic systems architect
- implementer - Pragmatic coding craftsman
```

### Unsupported Features

Factory does not support hooks. When hooks are configured, a warning is logged during sync.

---

## Subfolder Context Generator

Generates context files for monorepo subfolders, allowing different packages to have focused AI configurations.

### Configuration

```yaml
subfolder_contexts:
  packages/backend:
    rules: [_core, database, api]
    personas: [implementer, data-specialist]
    description: "Backend package context"

  packages/frontend:
    rules: [_core, ui, forms]
    personas: [implementer, ux-psychologist]
    description: "Frontend package context"

  apps/mobile:
    rules: [_core, mobile]
    personas: [implementer]
```

### Output Structure

For each configured subfolder:

```
packages/backend/
├── CLAUDE.md    # Claude Code entry point
└── AGENTS.md    # Cursor/Factory entry point
```

### CLAUDE.md Content

```markdown
<!-- DO NOT EDIT - Generated by ai-tool-sync -->

# Backend Package Context

## Description

Backend package context

## Included Skills

@import ../../.claude/skills/_core/SKILL.md
@import ../../.claude/skills/database/SKILL.md
@import ../../.claude/skills/api/SKILL.md

## Available Agents

- implementer - Pragmatic coding craftsman
- data-specialist - Database expert
```

### AGENTS.md Content

```markdown
<!-- DO NOT EDIT - Generated by ai-tool-sync -->

# Backend Package Context

## Description

Backend package context

## Included Rules

- _core - Core project context
- database - Database guidelines
- api - API design patterns

## Available Personas

- implementer - Pragmatic coding craftsman
- data-specialist - Database expert
```

---

## Tool Mapping

Generic tool names are mapped to target-specific names:

| Generic | Cursor | Claude | Factory |
|---------|--------|--------|---------|
| `read` | Read | Read | read |
| `write` | Create | Write | write |
| `edit` | Edit | Edit | edit |
| `execute` | Execute | Bash | execute |
| `search` | Grep | Search | search |
| `glob` | Glob | Glob | glob |
| `fetch` | FetchUrl | WebFetch | fetch |
| `ls` | LS | ListDir | list |

### Unknown Tools

Unknown tools are handled per-target:
- **Cursor:** Capitalized (e.g., `mytool` → `Mytool`)
- **Claude:** Capitalized (e.g., `mytool` → `Mytool`)
- **Factory:** Lowercase (e.g., `MyTool` → `mytool`)

---

## Model Mapping

Generic model names are mapped to target-specific identifiers:

| Generic | Cursor | Claude | Factory |
|---------|--------|--------|---------|
| `default` | inherit | claude-sonnet-4-20250514 | default |
| `fast` | inherit | claude-3-5-haiku-20241022 | fast |
| `powerful` | inherit | claude-sonnet-4-20250514 | powerful |
| `inherit` | inherit | (use default) | passthrough |

---

## Customizing Output

### Target Overrides

Create target-specific overrides in `.ai/targets/`:

```yaml
# .ai/targets/cursor.yaml
output:
  rules_dir: ".cursor/custom-rules"

frontmatter:
  rules:
    include_fields:
      - description
      - globs
      - alwaysApply
      - myCustomField
```

### Excluding Targets

Exclude content from specific targets:

```yaml
# In rule frontmatter
---
name: claude-only
description: Only for Claude
targets: [claude]  # Not generated for Cursor or Factory
---
```

### Custom Tool Mapping

Override tool mappings in target config:

```yaml
# .ai/targets/cursor.yaml
tool_mapping:
  execute: "RunCommand"  # Custom mapping
  mytool: "MyCustomTool"
```

### DO NOT EDIT Headers

Generated files include headers by default:

```markdown
<!-- DO NOT EDIT - Generated by ai-tool-sync -->
```

Disable with:

```yaml
output:
  add_do_not_edit_headers: false
```

### Clean Before Sync

By default, generated files are cleaned before each sync:

```yaml
output:
  clean_before_sync: true  # Default
```

Disable to preserve manual modifications (not recommended):

```yaml
output:
  clean_before_sync: false
```

---

## Dry Run

Preview generated output without writing files:

```bash
ai-sync --dry-run
```

Output:

```
[DRY RUN] Would generate:
  .cursor/rules/_core.mdc
  .cursor/rules/database.mdc
  .cursor/commands/roles/architect.md
  .claude/skills/_core/SKILL.md
  .claude/skills/database/SKILL.md
  .claude/agents/architect.md
  CLAUDE.md
  AGENTS.md
```

---

## Verbose Output

See detailed generation information:

```bash
ai-sync --verbose
```

Output includes:
- Files being generated
- Transformations applied
- Warnings for unsupported features
- Source of each piece of content

