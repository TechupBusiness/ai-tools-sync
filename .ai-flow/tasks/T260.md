# T260: Add Path-Based Validation to lint and validate Commands

> **Priority**: P3 | **Wave**: 3 | **Track**: DX (Developer Experience)
> **Depends on**: None
> **Estimated complexity**: Low

## 1. Objective

Enable `ai-sync lint` and `ai-sync validate` commands to accept explicit file/directory paths as arguments, allowing validation of individual files without requiring a full project configuration. This supports:

1. **Dogfooding**: Validating `defaults/` content within the ai-tool-sync project itself
2. **CI/CD**: Linting specific files in pre-commit hooks or CI pipelines
3. **Ad-hoc validation**: Quick checks on individual files during development

## 2. Prior Art (IMPORTANT)

Reference existing implementations:
- `src/cli/commands/lint.ts` - Current lint command implementation
- `src/cli/commands/validate.ts` - Current validate command implementation
- Standard CLI patterns: `eslint <file>`, `prettier <file>`, `tsc --project <path>`

## 3. Proposed CLI Interface

### lint command

```bash
# Current (project-centric)
ai-sync lint                          # Lint all rules in project

# New (file/path-centric)
ai-sync lint <file>                   # Lint a single file
ai-sync lint <glob>                   # Lint files matching glob
ai-sync lint defaults/rules/          # Lint all rules in directory
ai-sync lint defaults/rules/*.md      # Lint with glob pattern
```

### validate command

```bash
# Current (project-centric)
ai-sync validate                      # Validate entire project config

# New (path-centric)
ai-sync validate --path <dir>         # Validate files in directory
ai-sync validate --file <file>        # Validate a single file
```

## 4. Implementation Requirements

### 4.1 lint command changes

```typescript
// src/cli/commands/lint.ts
export const lintCommand = new Command('lint')
  .description('Lint rules for common issues')
  .argument('[files...]', 'Files or glob patterns to lint')
  .option('--fix', 'Automatically fix issues where possible')
  .action(async (files: string[], options) => {
    if (files.length > 0) {
      // Path-based mode: lint specific files
      return lintFiles(files, options);
    } else {
      // Project mode: lint all project rules
      return lintProject(options);
    }
  });
```

### 4.2 validate command changes

```typescript
// src/cli/commands/validate.ts
export const validateCommand = new Command('validate')
  .description('Validate configuration without generating output')
  .option('--path <dir>', 'Validate files in directory')
  .option('--file <file>', 'Validate a single file')
  .option('--verbose', 'Show detailed output')
  .action(async (options) => {
    if (options.path || options.file) {
      // Path-based mode
      return validatePath(options);
    } else {
      // Project mode (existing behavior)
      return validateProject(options);
    }
  });
```

### 4.3 File type detection

When validating individual files, detect the content type from:
1. Directory location (`rules/`, `personas/`, `commands/`, `hooks/`)
2. Frontmatter fields (e.g., presence of `event` field indicates hook)
3. Explicit `--type` flag as fallback

```bash
ai-sync lint defaults/rules/authoring-guide.md        # Auto-detect: rule
ai-sync lint --type persona some-file.md              # Explicit type
```

## 5. Test Requirements

### 5.1 Unit Tests

```typescript
describe('lint command', () => {
  it('should lint a single file by path', async () => {
    const result = await runCli(['lint', 'defaults/rules/code-review.md']);
    expect(result.exitCode).toBe(0);
  });

  it('should lint multiple files with glob', async () => {
    const result = await runCli(['lint', 'defaults/rules/*.md']);
    expect(result.exitCode).toBe(0);
  });

  it('should report errors for invalid files', async () => {
    const result = await runCli(['lint', 'tests/fixtures/invalid-rule.md']);
    expect(result.exitCode).toBe(1);
    expect(result.stderr).toContain('validation error');
  });
});

describe('validate command', () => {
  it('should validate a directory with --path', async () => {
    const result = await runCli(['validate', '--path', 'defaults/']);
    expect(result.exitCode).toBe(0);
  });

  it('should validate a single file with --file', async () => {
    const result = await runCli(['validate', '--file', 'defaults/rules/code-review.md']);
    expect(result.exitCode).toBe(0);
  });
});
```

## 6. Acceptance Criteria

- [ ] `ai-sync lint <file>` validates a single file and reports issues
- [ ] `ai-sync lint <glob>` validates files matching the glob pattern
- [ ] `ai-sync validate --path <dir>` validates all content files in directory
- [ ] `ai-sync validate --file <file>` validates a single file
- [ ] File type is auto-detected from directory or frontmatter
- [ ] `--type` flag allows explicit type specification
- [ ] Exit code is non-zero when validation fails
- [ ] Verbose output shows which files are being validated
- [ ] Documentation updated in `--help` output
- [ ] Works without `.ai-tool-sync/config.yaml` present

## 7. Out of Scope

- Schema generation from files
- Watch mode for continuous validation
- IDE integration (LSP, etc.)

## 8. Notes

- This enables proper dogfooding of ai-tool-sync within its own development
- Useful for CI pipelines that only want to validate changed files
- Consider adding this to pre-commit hook in the project
