# T254: Resolve Prettier Drift and Enforce Formatting

> **Priority**: P0 | **Wave**: 1 | **Track**: F (Codebase Quality)  
> **Depends on**: None  
> **Estimated complexity**: Low

## 1. Objective
Remove the current Prettier drift across source and test TypeScript files, establish a clean formatting baseline, and ensure `npm run format:check` stays green locally and in CI without altering runtime behavior or public APIs.

## 2. Prior Art (IMPORTANT)
- `package.json` - Source of the `format`/`format:check` scripts and their globs.
- `.prettierrc` - Prettier rules (LF line endings, print width 100, single quotes, etc.) to respect.
- `.prettierignore` - Excludes markdown/json/yaml/dist/coverage; do not shrink or bypass these ignores.
- `CONTRIBUTING.md` (Lint and Format section) - Contributor-facing commands that must remain accurate after any script/glob adjustments.

## 3. File Structure
```
src/
├── cli/…                 # Format-only; no behavioral edits
├── config/…              # Format-only
├── generators/…
├── loaders/…
├── parsers/…
├── transformers/…
└── utils/…
tests/
├── unit/…                # Format drift in specs
├── integration/…
└── e2e/…
```

## 4. Interfaces & Types
```typescript
/**
 * T254 is formatting-only: do not add, remove, or change public interfaces/exports.
 * If an import path must be adjusted for formatting, continue using '@/...' aliases
 * and keep type signatures identical.
 */
```

## 5. Implementation Requirements

### 5.1 Must Follow (Project Patterns)
- Use `npm run format` (Prettier 3) rather than manual whitespace edits.
- Preserve semantics—no logic, string content, or API changes; diffs should be formatting-only.
- Keep `@/` path aliases and existing import ordering intact (see learnings T206/T228) to avoid ESLint churn.
- Respect `.prettierignore`; do not format markdown/json/yaml or generated artifacts.
- If import ordering or linting shifts, resolve with `npm run lint`/`npm run lint:fix` without altering behavior.

### 5.2 Critical Logic (Pitfall Prevention)
- Do not hand-edit inline snapshots or template literals; allow Prettier to reflow only if needed and rerun tests if snapshots move.
- Maintain `endOfLine: 'lf'`; avoid introducing CRLF from Windows editors.
- Avoid touching `dist/` or `coverage/`; revert any incidental changes to generated assets.

### 5.3 Edge Cases to Handle
- [ ] Files annotated with `// prettier-ignore` remain unchanged.
- [ ] Mixed tabs/spaces and trailing comma/semicolon inconsistencies are normalized by Prettier, not by manual edits.
- [ ] Inline comments and disable directives stay attached to the code they describe after formatting.
- [ ] Any `.ts` fixtures under `tests/fixtures` (if encountered) keep their intended fixture semantics after formatting.

## 6. Test Requirements

### 6.1 Test File Structure
```typescript
describe('formatting baseline', () => {
  it('keeps CLI files formatted', () => {/* spot-check */});
  it('keeps transformer files formatted', () => {/* spot-check */});
});
```

### 6.2 Required Test Cases
- [ ] `npm run format` completes with no remaining diffs.
- [ ] `npm run format:check` passes after formatting.
- [ ] `npm run lint` remains clean (import/order, unused vars).
- [ ] Manual spot-check on a couple of CLI and transformer files to verify no behavioral edits slipped in.

## 7. Integration Points
- CI uses the existing npm scripts; ensuring `format:check` passes locally keeps the workflow green.
- Contributor docs (`CONTRIBUTING.md`) should remain accurate for formatting commands; adjust only if script/glob changes are required.

## 8. Acceptance Criteria
- [ ] Only formatting diffs are present; no runtime or type signature changes.
- [ ] `npm run format:check` passes locally and is expected to pass in CI.
- [ ] Plan entry `T254` in `plan.md` stays current (already added).
- [ ] No generated or ignored assets (`dist/`, `coverage/`, docs) are modified.

## 9. Out of Scope
- Changing Prettier rules, globs, or `.prettierignore` contents.
- Altering test command environments for Windows (`T255` handles that).
- Adding new lint rules or restructuring documentation content.

## 10. Guidelines for Writing Specs
**DO Include**
- Pointers to configs/scripts to reuse (`package.json`, `.prettierrc`, `.prettierignore`).
- Non-obvious pitfalls (inline snapshots, import order) and explicit checklists.
- Test and acceptance checkboxes that validate the formatting baseline.

**DO NOT Include**
- New features, API changes, or behavioral refactors masked as formatting.
- Tooling changes beyond Prettier/ESLint already configured.
- Cross-track work (e.g., Windows `NODE_OPTIONS` adjustments from T255).

