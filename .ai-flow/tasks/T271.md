# T271: Remove `subfolder_contexts` - Use Globs for Contextual Rules

> **Priority**: P1 | **Wave**: 1 | **Track**: A (Core Infrastructure)
> **Depends on**: T270
> **Estimated complexity**: Medium

## 1. Objective

Remove the `subfolder_contexts` configuration entirely. It's redundant with glob patterns and no AI coding tool actually supports subfolder-level context files. Cursor already has native glob support; Claude/Factory load by relevance or explicit invocation.

## 2. Rationale

### Why Remove

1. **No IDE supports subfolder contexts**: Cursor, Claude Code, and Factory all operate at project root level
2. **Redundant with globs**: Rules already have `globs:` patterns that specify which files they apply to
3. **Personas can't be embedded**: Personas are separate agent definitions, not context file content
4. **Maintenance burden**: Users specify same info twice (globs + subfolder_contexts)
5. **Generated files unused**: `packages/backend/CLAUDE.md` is never read by Claude Code

### What Globs Already Solve

```yaml
# Rule with globs - Cursor automatically applies when editing matching files
---
globs: ["packages/backend/**/*.ts", "**/migrations/**"]
---
```

## 3. Files to Modify

```
src/
├── config/
│   ├── types.ts              # Remove SubfolderContextConfig
│   └── validator.ts          # Remove subfolder_contexts validation
├── generators/
│   └── subfolder-context.ts  # DELETE entire file
├── cli/commands/
│   ├── sync.ts               # Remove subfolder generation calls
│   └── init.ts               # Remove subfolder_contexts from template
└── schemas/
    └── config.schema.json    # Remove subfolder_contexts from schema
docs/
├── CONFIGURATION.md          # Remove subfolder_contexts section
└── GENERATORS.md             # Remove subfolder generator docs
tests/
├── unit/generators/subfolder-context.test.ts  # DELETE
└── **/*subfolder*            # Remove related tests
```

## 4. Implementation Requirements

### 4.1 Remove Type Definitions

```typescript
// DELETE from src/config/types.ts
export interface SubfolderContextConfig {
  rules: string[];
  personas?: string[];
  description?: string;
}

// DELETE from Config interface
subfolder_contexts?: Record<string, SubfolderContextConfig>;
```

### 4.2 Remove Generator

- Delete `src/generators/subfolder-context.ts` entirely
- Remove from generator registry/exports

### 4.3 Update sync.ts

Remove calls to subfolder context generation (~lines 228-232, 454-475)

### 4.4 Update init.ts Template

Remove commented subfolder_contexts section from generated config.yaml

### 4.5 Update Documentation

- Remove from docs/CONFIGURATION.md (lines 288-323)
- Remove from docs/GENERATORS.md
- Update README.md if mentioned

## 5. Migration Guide (for docs)

```markdown
## Breaking Change: subfolder_contexts Removed

The `subfolder_contexts` configuration has been removed. Use glob patterns instead:

**Before (removed):**
```yaml
subfolder_contexts:
  packages/backend:
    rules: [database, api]
```

**After (use globs in rules):**
```yaml
# In rules/database.md frontmatter:
---
globs: ["packages/backend/**/*.sql", "**/migrations/**"]
---
```

Cursor automatically applies rules based on globs. Claude/Factory load
rules by relevance - no per-folder configuration needed.
```

## 6. Test Requirements

- [ ] Remove all subfolder-context tests
- [ ] Verify sync works without subfolder generation
- [ ] Verify init generates config without subfolder_contexts section
- [ ] Verify schema rejects subfolder_contexts with clear error

## 7. Acceptance Criteria

- [ ] `subfolder_contexts` removed from types, schema, validator
- [ ] `subfolder-context.ts` generator deleted
- [ ] sync.ts no longer generates subfolder files
- [ ] init.ts template updated
- [ ] Documentation updated with migration guide
- [ ] All tests pass
- [ ] Format check pass

## 8. Out of Scope

- Adding glob support to Claude/Factory (platform limitation)
- Auto-generating per-directory rules based on globs (future consideration)

