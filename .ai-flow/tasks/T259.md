# T259: Add Defaults Prompt Skill for LLM Authoring

> **Priority**: P2 | **Wave**: 3 | **Track**: F (Generic Format Skills)
> **Depends on**: T239 ✅, T231 ✅
> **Estimated complexity**: Low

## 1. Objective

Ship a default "authoring guide" rule in `defaults/rules/` that instructs LLMs how to draft rules, personas, commands, and hooks using the generic ai-tool-sync format. This provides a single source of truth for content creation that LLMs can reference when users ask them to create or modify AI assistant configurations. The skill consolidates schema knowledge, slugging conventions, validation workflows, and platform mapping expectations into one auto-loadable reference.

## 2. Prior Art (IMPORTANT)

Reference existing implementations to copy patterns from:
- `defaults/rules/code-review.md` - Copy frontmatter structure (name, description, version, globs, targets, category, priority)
- `defaults/rules/documentation.md` - Similar rule pattern for comprehensive guidance
- `defaults/personas/architect.md` - Example of well-structured markdown body with personality/guidance sections
- `src/schemas/*.schema.json` - Authoritative source for all frontmatter field definitions
- `src/creators/generator.ts` - Validation and normalization logic for understanding constraints
- `docs/CONFIGURATION.md` - Reference for documenting config structure

## 3. File Structure

```
defaults/
└── rules/
    └── authoring-guide.md    # New authoring guide skill
```

No code changes required—this is purely a content addition to `defaults/rules/`.

## 4. Interfaces & Types

Not applicable—this task creates content, not code. The output file must conform to the existing `Rule` interface:

```typescript
// Reference from src/parsers/rule.ts - file must validate against this
interface Rule {
  name: string;                    // Required: "authoring-guide"
  description?: string;            // Human-readable description
  version?: string;                // Semver: "1.0.0"
  always_apply?: boolean;          // false - triggered by glob patterns
  globs?: string[];                // Trigger patterns for this rule
  targets?: TargetType[];          // [cursor, claude, factory]
  requires?: string[];             // Dependent rules
  category?: RuleCategory;         // documentation | tooling
  priority?: Priority;             // medium
  cursor?: CursorExtension;        // Platform-specific overrides
  claude?: ClaudeExtension;
  factory?: FactoryExtension;
}
```

## 5. Implementation Requirements

### 5.1 Must Follow (Project Patterns)

- [x] Use snake_case for frontmatter fields (`always_apply`, not `alwaysApply`)
- [x] Include `version: 1.0.0` for tracking
- [x] Set `targets: [cursor, claude, factory]` to apply across all platforms
- [x] Use `globs:` patterns that trigger when working with config files
- [x] Set `category: documentation` or `tooling`
- [x] Set `priority: medium`

### 5.2 Content Requirements

The rule body must cover these sections:

#### A. Generic File Kinds
Document the four content types:
- **rule** - Guidelines and skills (`.ai-tool-sync/rules/*.md`)
- **persona** - Agent personalities (`.ai-tool-sync/personas/*.md`)
- **command** - Slash commands (`.ai-tool-sync/commands/*.md`)
- **hook** - Lifecycle hooks (`.ai-tool-sync/hooks/*.md`)

#### B. Frontmatter Schema Reference
For each kind, document:
- Required fields and their types
- Optional fields with defaults
- Platform-specific extension objects (`cursor:`, `claude:`, `factory:`)

#### C. Naming Conventions
- Names convert to slugs: "Database Rules" → `database-rules`
- Use lowercase alphanumeric with hyphens
- Avoid underscores (converted to hyphens)
- File extension is always `.md`

#### D. Tool Mappings
Document generic tool names and their platform equivalents:
| Generic | Cursor | Claude | Factory |
|---------|--------|--------|---------|
| read | Read | Read | Read |
| write | Create | Write | Write |
| edit | Edit | Edit | Edit |
| execute | Execute | Bash | Bash |
| search | Grep | Search | Search |
| glob | Glob | Glob | Glob |
| fetch | FetchUrl | Fetch | Fetch |
| ls | LS | LS | LS |

#### E. Model Mappings
Document generic model values:
| Generic | Description |
|---------|-------------|
| default | Platform default model |
| fast | Optimized for speed |
| powerful | Highest capability |
| inherit | Use session model |

#### F. Validation Workflow Checklist
Include actionable steps:
```markdown
## Validation Checklist

Before committing new content:

1. **Dry-run preview**:
   ```bash
   ai-sync create <kind> "<name>" --dry-run
   ```

2. **Lint validation (rules only)**:
   ```bash
   ai-sync create rule "<name>" --dry-run --run-lint
   ```

3. **Full sync test**:
   ```bash
   ai-sync --dry-run
   ```

4. **Check for warnings about**:
   - Unknown tool names
   - Unmapped model values
   - Missing required fields
```

#### G. Platform Extension Overrides
Show when and how to use platform-specific extensions:
```yaml
---
name: my-rule
# ... common fields ...
cursor:
  alwaysApply: true  # Cursor-specific: camelCase
claude:
  import_as_skill: true
factory:
  reasoningEffort: high
---
```

#### H. Collision/Overwrite Guidance
- Files with matching names will collide
- Use `--force` or `overwrite: true` to replace
- Check `ai-sync status` for existing generated files
- Consider renaming to avoid overwrites

### 5.3 Frontmatter for the Rule File

```yaml
---
name: authoring-guide
description: Guide for drafting ai-tool-sync rules, personas, commands, and hooks
version: 1.0.0
always_apply: false
globs:
  - ".ai-tool-sync/**/*.md"
  - ".ai-tool-sync/**/*.yaml"
  - ".ai-tool-sync/config.yaml"
targets:
  - cursor
  - claude
  - factory
category: documentation
priority: medium
---
```

### 5.4 Edge Cases to Handle

- [x] Content must be comprehensive but scannable (use tables, code blocks)
- [x] Include both beginner and advanced patterns
- [x] Reference but don't duplicate `docs/CONFIGURATION.md` content
- [x] Keep examples minimal and focused on patterns, not full implementations

## 6. Test Requirements

### 6.1 Validation Tests

Since this is content, validation is through existing infrastructure:

```bash
# Verify the new file parses correctly
npm test -- rule.test.ts

# Or manually:
ai-sync validate --verbose
```

### 6.2 Required Checks

- [x] File parses without errors via `parseRule()`
- [x] Frontmatter passes JSON schema validation
- [x] File included in `ai-sync sync` output for all targets
- [x] Glob patterns trigger correctly on `.ai-tool-sync/` files
- [x] Content renders correctly as Cursor MDC, Claude skill, Factory skill

### 6.3 Manual QA Checklist

- [ ] Read through the generated output in each platform format
- [ ] Verify all code examples are syntactically correct
- [ ] Check tables render properly in markdown
- [ ] Ensure the checklist is actionable

## 7. Integration Points

- **Used by**: LLMs when users request to create/edit AI configurations
- **Generated to**:
  - `.cursor/rules/authoring-guide.mdc`
  - `.claude/skills/authoring-guide/SKILL.md`
  - `.factory/skills/authoring-guide/SKILL.md`
- **Config**: No config changes needed; file auto-discovered in `defaults/rules/`
- **Docs**: Consider adding reference in `docs/CONFIGURATION.md` pointing to this skill

## 8. Acceptance Criteria

- [x] `defaults/rules/authoring-guide.md` exists and parses without errors
- [x] `npm run format:check` passes (or run `npm run format`)
- [x] `ai-sync validate` succeeds (dogfooding config added)
- [x] `ai-sync --dry-run` includes the new rule in output
- [x] Content covers all four kinds (rule, persona, command, hook)
- [x] Tool and model mappings are documented
- [x] Validation workflow checklist is included
- [x] Platform extension examples are provided
- [x] File shows up in generated outputs for cursor, claude, factory
- [x] plan.md updated with T259 completion

## 9. Out of Scope

- Interactive wizard or prompts (just static guidance content)
- Auto-completion or IDE integration (future consideration)
- Schema generation or API docs (handled by existing docs)
- Translations or localization (English only)

## 10. Example Content Outline

```markdown
# AI Tool Sync Authoring Guide

Guide for drafting rules, personas, commands, and hooks using the generic ai-tool-sync format.

## Quick Reference

| Kind | Location | Required Fields | Primary Use |
|------|----------|-----------------|-------------|
| rule | `rules/` | `name` | Guidelines, skills, context |
| persona | `personas/` | `name` | Agent personalities |
| command | `commands/` | `name`, `execute` | Slash commands |
| hook | `hooks/` | `name`, `event` | Lifecycle automation |

## Creating Content

### Rules
[Schema details, examples, glob patterns...]

### Personas
[Schema details, tools array, model selection...]

### Commands
[Schema details, execute field, args, variables...]

### Hooks
[Schema details, events, tool_match patterns...]

## Validation Workflow
[Checklist from section 5.2.F...]

## Platform Mappings
[Tool and model tables...]

## Platform Extensions
[Override examples...]

## Common Pitfalls
- Using camelCase in generic frontmatter (use snake_case)
- Forgetting required fields
- Unknown tool/model values without mappings
- File naming conflicts
```

## 11. Notes

- This rule will be auto-discovered because it lives in `defaults/rules/`
- The `use.rules` config can exclude it if a project doesn't want it
- Consider this a "meta" skill—it teaches LLMs how to create other skills
- Keep content evergreen; avoid version-specific details that will stale

